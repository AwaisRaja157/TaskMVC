@using TaskMVC.Models;
@{
    ViewBag.Title = "Employee";

    Employee employee = ViewBag.Employee as Employee;

    employee.Name = "Zawar";
    employee.DateOfBirth = DateTime.Now.AddYears(-25);
    employee.GPA = 3;
    employee.NDouble = 3.0;
    employee.PocketMoney = 300000;
    employee.Salary = 70000;
    employee.TimeStamp = DateTime.Now;
    employee.UrduName = "Zawar";


    List<Employee> Employee = ViewBag.M as List<Employee>;
}

<h2>Employee</h2>


@if (TempData["Error"] != null)
{
    @Html.Raw(TempData["Error"])

}

<form action="@Url.Action("Employee","Home")" method="post" id="MyForm">
    <div class="row">
        <div class="col-md-3">
            <div class="form-group">
                <label>Name</label>
                <input class="form-control" name="Name" id="Name" value="@employee.Name" />
                <label id="NameLabel"></label>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group">
                <label>Salary</label>
                <input class="form-control" name="Salary" id="Salary" value="@employee.Salary" />
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group">
                <label>PocketMoney</label>
                <input class="form-control" name="PocketMoney" id="PocketMoney" value="@employee.PocketMoney" />
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group">
                <label>GPA</label>
                <input class="form-control" name="GPA" id="GPA" value="@employee.GPA" />
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <div class="form-group">
                <label>NDouble</label>
                <input class="form-control" name="NDouble" id="NDouble" value="@employee.NDouble" />
            </div>
        </div>

        <div class="col-md-3">
            <div class="form-group">
                <label>TimeStamp</label>
                <input class="form-control" name="TimeStamp" id="TimeStamp" value="@employee.TimeStamp" />
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group">
                <label>DateOfBirth</label>
                <input class="form-control" name="DateOfBirth" id="DateOfBirth" type="date" value="@employee.DateOfBirth" />
            </div>
        </div>

        <div class="col-md-3">
            <div class="form-group">
                <label>UrduName</label>
                <input class="form-control" name="UrduName" id="UrduName" value="@employee.UrduName" />
            </div>
        </div>
    </div>
    <div class="pull-right">
        <button class="btn btn-primary" type="button" id="SubmitForm">Submit</button>
    </div>
</form>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>Name</th>
            <th>Salary</th>
            <th>PocketMoney</th>
            <th>NDouble</th>
            <th>GPA</th>
            <th>TimeStamp</th>
            <th>DateOfBirth</th>
            <th>UrduName</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody id="TableBody">
        @foreach (var element in Employee)
        {
            <tr>
                <td>@element.Name</td>
                <td>@element.Salary</td>
                <td>@element.PocketMoney</td>
                <td>@element.NDouble</td>
                <td>@element.GPA</td>
                <td>@element.TimeStamp</td>
                <td>@element.DateOfBirth</td>
                <td>@element.UrduName</td>
                <td>
                    <a href="@Url.Action("Employee","Home" , new { ID = element.ID })"><i class="glyphicon glyphicon-pencil"></i></a>
                    <form action="@Url.Action("DeleteEmployee", "Home" , new { ID = element.ID })" method="post">
                        <button type="submit"><i class="glyphicon glyphicon-trash text-danger"></i></button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts
{
    <script>
        $(function () {


            $("#MyForm").validate({
                rules: {
                    Name: {
                        required: true,
                        maxlength: 50
                    }
                  
                },
                messages: {
                    Name: {
                        required : 'Name is required',
                    }
                }


            });


            function FormatDate(jsonDate) {
                var date = new Date(parseInt(jsonDate.substr(6)));
                return date;
            }


            $("#SubmitForm").click(function () {

                if ($("#MyForm").valid()) {
                    var User = {
                        Name: $("#Name").val(),
                        Salary: $("#Salary").val(),
                        PocketMoney: $("#PocketMoney").val(),
                        GPA: $("#GPA").val(),
                        NDouble: $("#NDouble").val(),
                        TimeStamp: $("#TimeStamp").val(),
                        DateOfBirth: $("#DateOfBirth").val(),
                        UrduName : $("#UrduName").val()
                    }

                    $.ajax({
                        url: "@Url.Action("Employee", "Home")",
                        method: "POST", 
                        data: {
                            employee: User
                        },
                        success: function (resp) {
                            console.log(resp);
                            AddRow(resp);
                        },
                        error: function (resp) {

                        }
                    });
                }
            });


            function AddRow(element) {
                var html = `
     <tr>
                <td>${element.Name}</td>
                <td>${element.Salary}</td>
                <td>${element.PocketMoney}</td>
                <td>${element.NDouble}</td>
                <td>${element.GPA}</td>
                <td>${element.TimeStamp}</td>
                <td>${FormatDate(element.DateOfBirth)}</td>
                <td>${element.UrduName}</td>
                <td>
                    <a href="@Url.Action("Employee","Home")/${element.ID}"><i class="glyphicon glyphicon-pencil"></i></a>
                    <form action="@Url.Action("DeleteEmployee", "Home")/${element.ID}" method="post">
                        <button type="submit"><i class="glyphicon glyphicon-trash text-danger"></i></button>
                    </form>
                </td>
            </tr>

    `;
                $("#TableBody").append(html);

            }

        });
    </script>

}
